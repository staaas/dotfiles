- name: install bluetooth
  pacman:
    state: installed
    package: bluez
  become: yes
- name: auto enable bluetooth controller
  lineinfile: >
    dest=/etc/bluetooth/main.conf
    line="AutoEnable=true"
    regexp="AutoEnable="
  become: yes
- name: enable and start bluetooth service
  service: name=bluetooth state=started enabled=yes
  become: yes

- name: install pipewire
  pacman:
    state: installed
    package:
    - pipewire
    - pipewire-media-session
    - pipewire-pulse
    - pavucontrol
    - pamixer
  become: yes
- name: make sure pipewire-media-session config directory exists
  file: path=/etc/pipewire/media-session.d state=directory recurse=yes
  become: yes
- name: install custom bluez-monitor.conf for pipewire-media-session
  template: src=templates/pipewire/bluez-monitor.conf dest=/etc/pipewire/media-session.d/bluez-monitor.conf
  become: yes
- name: install xdg-desktop-portal that uses pipewire
  pacman:
    state: installed
    package:
    - xdg-desktop-portal
    - xdg-desktop-portal-wlr
  become: yes

- name: install audio packages
  pacman:
    state: installed
    package:
    - deadbeef
    - ffmpeg
    - libvorbis
    - libmad
    - flac
    - vlc
  become: yes

- name: install mpv
  pacman: package=mpv state=installed
  become: yes
- name: ensure mpv configuration dir exists
  file: path={{ ansible_env.HOME }}/.config/mpv state=directory recurse=yes
- name: copy mpv configuration
  template: src=templates/mpv.conf dest={{ ansible_env.HOME }}/.config/mpv/mpv.conf

- name: install imaging packages
  pacman:
    state: installed
    package:
    - sxiv
    - imagemagick
    - gimp
    - scrot
  become: yes
